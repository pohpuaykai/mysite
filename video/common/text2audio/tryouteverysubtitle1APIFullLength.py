list0 = [   'This is a circuit with two resistors connected in parallel, '
                 'lets find all the equations related to the components of '
                 'this circuit',
                 'With these circuit elements and Kirchhoff Current Law, we '
                 'can get this formula:',
                 'The highlighted variable comes from this battery, with '
                 'identity number 8.',
                 'This resistor, with identity number 0, produces this '
                 'highlighted variable.',
                 'The highlighted variable is associated with this resistor, '
                 'identity number 3.',
                 'With these circuit elements and Kirchhoff Voltage Law, we '
                 'can get this formula:',
                 'This resistor, with identity number 0, produces this '
                 'highlighted variable.',
                 'The highlighted variable comes from this battery, with '
                 'identity number 8.',
                 'The following formula is derived from Kirchhoff Voltage Law, '
                 'based on these circuit elements:',
                 'This battery, with identity number 8, produces this '
                 'highlighted variable.',
                 'This resistor, with identity number 3, produces this '
                 'highlighted variable.',
                 'With these circuit elements and Ohm Law, we can get this '
                 'formula:',
                 'The highlighted variable comes from this resistor, with '
                 'identity number 0.',
                 'The highlighted variable comes from this resistor, with '
                 'identity number 0.',
                 'The highlighted variable comes from this resistor, with '
                 'identity number 0.',
                 'With these circuit elements and Ohm Law, we can get this '
                 'formula:',
                 'The highlighted variable is associated with this resistor, '
                 'identity number 3.',
                 'The highlighted variable is associated with this resistor, '
                 'identity number 3.',
                 'The highlighted variable is associated with this resistor, '
                 'identity number 3.',
                 'The following formula is derived from Ohm Law, based on '
                 'these circuit elements:',
                 'This battery, with identity number 8, produces this '
                 'highlighted variable.',
                 'The highlighted variable comes from this battery, with '
                 'identity number 8.',
                 'The highlighted variable comes from this battery, with '
                 'identity number 8.',
                 'We have found all the equations relating to the two '
                 'resistors and their parallel connectivity.']

text0 = '\n'.join(list0)

list1 = [   'Der folgende Stromkreis ist eine ParallelSchaltung. '
                 'Versuchen wir jetzt, alle Gleichungen der Bauelemente dieses '
                 'Stromkreises aufzuschreiben',
                 'Mit diesen Bauelementen und Regel von KIRCHHOFF: Knotenregel '
                 'können wir diese Formel erhalten:',
                 'Dieser Akku mit der Identitätsnummer 8 erzeugt diese '
                 'hervorgehobene Variable.',
                 'Dieser Widerstand mit der Identitätsnummer 0 erzeugt diese '
                 'hervorgehobene Variable.',
                 'Dieser Widerstand mit der Identitätsnummer 3 erzeugt diese '
                 'hervorgehobene Variable.',
                 'Wenn wir Regel von KIRCHHOFF: Maschenregel auf diesen '
                 'Bauelementen anwenden, erhalten wir die folgende Formel:',
                 'Die hervorgehobene Variable ist mit diesem Widerstand, '
                 'Identitätsnummer 0 verknüpft.',
                 'Die hervorgehobene Variable stammt von diesem Akku mit der '
                 'Identitätsnummer 8.',
                 'Mit diesen Bauelementen und Regel von KIRCHHOFF: '
                 'Maschenregel können wir diese Formel erhalten:',
                 'Die hervorgehobene Variable ist mit diesem Akku, '
                 'Identitätsnummer 8 verknüpft.',
                 'Die hervorgehobene Variable ist mit diesem Widerstand, '
                 'Identitätsnummer 3 verknüpft.',
                 'Mit diesen Bauelementen und Ohmsches Gesetz können wir diese '
                 'Formel erhalten:',
                 'Die hervorgehobene Variable stammt von diesem Widerstand mit '
                 'der Identitätsnummer 0.',
                 'Dieser Widerstand mit der Identitätsnummer 0 erzeugt diese '
                 'hervorgehobene Variable.',
                 'Die hervorgehobene Variable ist mit diesem Widerstand, '
                 'Identitätsnummer 0 verknüpft.',
                 'Mit diesen Bauelementen und Ohmsches Gesetz können wir diese '
                 'Formel erhalten:',
                 'Die hervorgehobene Variable stammt von diesem Widerstand mit '
                 'der Identitätsnummer 3.',
                 'Die hervorgehobene Variable ist mit diesem Widerstand, '
                 'Identitätsnummer 3 verknüpft.',
                 'Die hervorgehobene Variable ist mit diesem Widerstand, '
                 'Identitätsnummer 3 verknüpft.',
                 'Die folgende Formel wird aus Ohmsches Gesetz abgeleitet, '
                 'basierend auf diesen Bauelementen:',
                 'Die hervorgehobene Variable stammt von diesem Akku mit der '
                 'Identitätsnummer 8.',
                 'Dieser Akku mit der Identitätsnummer 8 erzeugt diese '
                 'hervorgehobene Variable.',
                 'Die hervorgehobene Variable ist mit diesem Akku, '
                 'Identitätsnummer 8 verknüpft.',
                 'Wir haben alle Gleichungen der Bauelemente dieses '
                 'Stromkreises gefunden,']

text1 = '\n'.join(list1)

list2 = [   'Nous avons deux résistances en parallèle et nous allons '
                 'trouver toutes les équations relatives à ses composants.',
                 'Si nous appliquons Loi des nœuds (Première loi de Kirchhoff) '
                 'à ces composants, nous obtenons la formule suivante:',
                 'La variable en couleur est liée à ce Piles AA, numéro '
                 "d'identité 8.",
                 "Ce résistance avec le numéro d'identité 0 crée cette "
                 'variable en couleur.',
                 'La variable en couleur est liée à ce résistance, numéro '
                 "d'identité 3.",
                 'Si nous appliquons Loi des mailles (Deuxième loi de '
                 'Kirchhoff) à ces composants, nous obtenons la formule '
                 'suivante:',
                 "Ce résistance avec le numéro d'identité 0 crée cette "
                 'variable en couleur.',
                 'La variable en couleur est liée à ce Piles AA, numéro '
                 "d'identité 8.",
                 'Si nous appliquons Loi des mailles (Deuxième loi de '
                 'Kirchhoff) à ces composants, nous obtenons la formule '
                 'suivante:',
                 'La variable en couleur est liée à ce Piles AA, numéro '
                 "d'identité 8.",
                 'La variable en couleur est liée à ce résistance, numéro '
                 "d'identité 3.",
                 'Si nous appliquons la loi d’Ohm à ces composants, nous '
                 'obtenons la formule suivante:',
                 'La variable en couleur provient de ce résistance avec le '
                 "numéro d'identité 0.",
                 'La variable en couleur provient de ce résistance avec le '
                 "numéro d'identité 0.",
                 'La variable en couleur provient de ce résistance avec le '
                 "numéro d'identité 0.",
                 'Si nous appliquons la loi d’Ohm à ces composants, nous '
                 'obtenons la formule suivante:',
                 'La variable en couleur provient de ce résistance avec le '
                 "numéro d'identité 3.",
                 "Ce résistance avec le numéro d'identité 3 crée cette "
                 'variable en couleur.',
                 'La variable en couleur provient de ce résistance avec le '
                 "numéro d'identité 3.",
                 'La formule suivante est dérivée de la loi d’Ohm en fonction '
                 'de ces composants:',
                 'La variable en couleur est liée à ce Piles AA, numéro '
                 "d'identité 8.",
                 "Ce Piles AA avec le numéro d'identité 8 crée cette variable "
                 'en couleur.',
                 'La variable en couleur est liée à ce Piles AA, numéro '
                 "d'identité 8.",
                 'Nous avons trouvé toutes les équations relatives à ses '
                 'composants.']

text2 = '\n'.join(list2)

list3 = [   'こちらは、並列に接続されている抵抗が二つである。その並列回路の素子においての公式を、全て見つけましょう',
                 'これらの電気部品に キルヒホッフの電流法則 を使用すると、次の公式が得られます。',
                 '8番号の電気部品のアルカリ乾電池における、強調した未知数は出てきます。',
                 'その0番号の電気部品の抵抗器で、強調した未知数は作れました。',
                 'その3番号の電気部品の抵抗器で、強調した未知数は作れました。',
                 '次の公式は、これらの電気部品によって、キルヒホッフの電圧法則 を付けると、得られます。',
                 '0番号の電気部品の抵抗器における、強調した未知数は出てきます。',
                 '8番号の電気部品のアルカリ乾電池における、強調した未知数は出てきます。',
                 '次の公式は、これらの電気部品によって、キルヒホッフの電圧法則 を付けると、得られます。',
                 '8番号の電気部品のアルカリ乾電池における、強調した未知数は出てきます。',
                 'その3番号の電気部品の抵抗器で、強調した未知数は作れました。',
                 'これらの電気部品に オームの法則 を使用すると、次の公式が得られます。',
                 '強調した未知数は、その0番号の電気部品の抵抗器から、出てきます。',
                 '強調した未知数は、その0番号の電気部品の抵抗器から、出てきます。',
                 '強調した未知数は、その0番号の電気部品の抵抗器から、出てきます。',
                 '次の公式は、これらの電気部品によって、オームの法則 を付けると、得られます。',
                 '強調した未知数は、その3番号の電気部品の抵抗器から、出てきます。',
                 '強調した未知数は、その3番号の電気部品の抵抗器から、出てきます。',
                 '3番号の電気部品の抵抗器における、強調した未知数は出てきます。',
                 'これらの電気部品に オームの法則 を使用すると、次の公式が得られます。',
                 '8番号の電気部品のアルカリ乾電池における、強調した未知数は出てきます。',
                 '強調した未知数は、その8番号の電気部品のアルカリ乾電池から、出てきます。',
                 'その8番号の電気部品のアルカリ乾電池で、強調した未知数は作れました。',
                 '今まで、その並列回路の素子においての公式を、求めました。']

text3 = '\n'.join(list3)

list4 = [   'У нас есть два резистора, соединенных параллельно, и нам '
                 'нужно найти все уравнения, связанные с их компонентами.',
                 'С помощью этих компонентов и Первое правило Кирхгофа '
                 '(правило токов Кирхгофа) мы можем получить эту формулу:',
                 'Выделенная переменная связана с этим аккумуляторов, '
                 'идентификационный номер 8.',
                 'Выделенная переменная связана с этим Резистор, '
                 'идентификационный номер 0.',
                 'Выделенная переменная связана с этим Резистор, '
                 'идентификационный номер 3.',
                 'Если мы применим Второе правило Кирхгофа (правило напряжений '
                 'Кирхгофа) к этим компонентам, мы получим следующую формулу:',
                 'Выделенная переменная связана с этим Резистор, '
                 'идентификационный номер 0.',
                 'Выделенная переменная берется из этого аккумуляторов с '
                 'идентификационным номером 8.',
                 'С помощью этих компонентов и Второе правило Кирхгофа '
                 '(правило напряжений Кирхгофа) мы можем получить эту формулу:',
                 'Выделенная переменная берется из этого аккумуляторов с '
                 'идентификационным номером 8.',
                 'Этот Резистор с идентификационным номером 3 создает эту '
                 'выделенную переменную.',
                 'Если мы применим Закон Ома к этим компонентам, мы получим '
                 'следующую формулу:',
                 'Выделенная переменная связана с этим Резистор, '
                 'идентификационный номер 0.',
                 'Выделенная переменная берется из этого Резистор с '
                 'идентификационным номером 0.',
                 'Выделенная переменная связана с этим Резистор, '
                 'идентификационный номер 0.',
                 'Если мы применим Закон Ома к этим компонентам, мы получим '
                 'следующую формулу:',
                 'Выделенная переменная связана с этим Резистор, '
                 'идентификационный номер 3.',
                 'Выделенная переменная берется из этого Резистор с '
                 'идентификационным номером 3.',
                 'Этот Резистор с идентификационным номером 3 создает эту '
                 'выделенную переменную.',
                 'Если мы применим Закон Ома к этим компонентам, мы получим '
                 'следующую формулу:',
                 'Выделенная переменная связана с этим аккумуляторов, '
                 'идентификационный номер 8.',
                 'Этот аккумуляторов с идентификационным номером 8 создает эту '
                 'выделенную переменную.',
                 'Этот аккумуляторов с идентификационным номером 8 создает эту '
                 'выделенную переменную.',
                 'Мы нашли все уравнения, касающиеся его компонентов.']

text4 = '\n'.join(list4)

list5 = [   '我们求，此二电阻器并联电路内，所有方程式。',
                 '利用这些电路元件和基尔霍夫电流定律，我们可以得到这个公式：',
                 '标注的变数可以从8编号的电池取得。',
                 '标注的变数可以从0编号的电阻器取得。',
                 '3编号的电阻器让我们取得标注的变数。',
                 '基于这些电路元件，从基尔霍夫电压定律中可以得出以下公式：',
                 '标注的变数可以从0编号的电阻器取得。',
                 '标注的变数可以从8编号的电池取得。',
                 '将基尔霍夫电压定律应用在这些电路原件上，我们取得这公式：',
                 '我们可以从8编号的电池取得标注的变数。',
                 '3编号的电阻器让我们取得标注的变数。',
                 '基于这些电路元件，从欧姆定律中可以得出以下公式：',
                 '0编号的电阻器让我们取得标注的变数。',
                 '我们可以从0编号的电阻器取得标注的变数。',
                 '我们可以从0编号的电阻器取得标注的变数。',
                 '利用这些电路元件和欧姆定律，我们可以得到这个公式：',
                 '我们可以从3编号的电阻器取得标注的变数。',
                 '标注的变数可以从3编号的电阻器取得。',
                 '标注的变数可以从3编号的电阻器取得。',
                 '利用这些电路元件和欧姆定律，我们可以得到这个公式：',
                 '标注的变数可以从8编号的电池取得。',
                 '标注的变数可以从8编号的电池取得。',
                 '我们可以从8编号的电池取得标注的变数。',
                 '现阶段，我们以求获所有相关的方程式。']

text5 = '\n'.join(list5)

#import pyttsx3
from video.common.text2audio import pyttsx3
import time

engine = pyttsx3.init()
voices = engine.getProperty('voices') # only to get the voices to get the mapping

works = [
    {
        'text':text0,
        'voice':voices[2].id,
        'filep':'en'
    },
    {
        'text':text1,
        'voice':voices[1].id,
        'filep':'de'
    },
    {
        'text':text2,
        'voice':voices[3].id,
        'filep':'fr'
    },
    {
        'text':text3,
        'voice':voices[4].id,
        'filep':'jp'
    },
    {
        'text':text4,
        'voice':voices[5].id,
        'filep':'ru'
    },
    {
        'text':text5,
        'voice':voices[6].id,
        'filep':'zh'
    }
]
#breakEveryTiming = 1.0#[for splitting subtitles]might need to be customised according to language, or situation... but we hardcode this for now
speakerOccupied = False
workIdx = 0

languages__list_tuple_word_location_length_elapsedTime = {}
list_tuple_word_location_length_elapsedTime = []

def recorder(word, location, length, elapsedTime):
    list_tuple_word_location_length_elapsedTime.append((word, location, length, elapsedTime))

while workIdx < len(works):
    #init
    language = works[workIdx]['filep']
    #languages__list_tuple_word_location_length_elapsedTime[language] = []
    #
    
    #
    while speakerOccupied:
        #print('speakerOccupied')
        time.sleep(1) # wait 1 second
    #
    #speaker not occupied anymore
    from video.common.text2audio import pyttsx3
    engine = pyttsx3.init()
    voices = engine.getProperty('voices')
    now = time.time() # reference time
    #
    engine.setProperty('rate', 150)#You can adjust this value as needed
    engine.setProperty('volume', 0.1)#1.0 is maximum volume
    #
    #hooks and their attachment to engine
    def onStart(name):
        #print('Starting:', name, '(', time.time() - now,')')
        speakerOccupied = True
    def onWord(name, word, location, length):
        timeElapsed = time.time() - now
        recorder = name['recorder']
        #print('Word:', word, location, length, '(', timeElapsed,')', name)#move doen 1 instruction, still work?
        recorder(word, location, length, timeElapsed)
        #print('onWord', 'list_tuple_word_location_length_elapsedTime', list_tuple_word_location_length_elapsedTime)
        
    def onEnd(name, completed):#name is idx
        #print('running End, name:', '_inLoop', engine._inLoop, '_isBusy', engine.proxy._busy, '@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@')
        #print(name) 
        _idx = name['idx']
        #print('onEnd, _idx: ', _idx)
        #print('Finishing:', name, completed, '(', time.time() - now,')', '_inLoop', engine._inLoop, '_isBusy', engine.proxy._busy)
        speakerOccupied = False
    def onError(e):
        print(e)
    engine.connect('started-utterance', onStart)
    engine.connect('started-word', onWord) # Note: 'word' event might not be supported by all drivers
    engine.connect('finished-utterance', onEnd)
    engine.connect('error', onError)
    #
    work = works[workIdx]
    engine.setProperty('voice', work['voice'])
    engine.say(work['text'], name={'idx':workIdx, 'recorder':recorder})
    engine.save_to_file(work['text'], 'D:\\textToSpeech\\withHooks\\'+work['filep']+'.wav')
    if workIdx >= len(works)-1:
        #engine.proxy.endLoop(False) # this ends the pumping
        engine.proxy._push(engine.endLoop, ())
    
    engine.runAndWait() # has to call this every idx else, package will not wait for .Speech to finish? 
    #runNext({'idx':workIdx, 'recorder':recorder})
    #
    
    #
    engine.disconnect({'topic':'started-utterance', 'cb':onStart})
    engine.disconnect({'topic':'started-word', 'cb':onWord}) # Note: 'word' event might not be supported by all drivers
    engine.disconnect({'topic':'finished-utterance', 'cb':onEnd})
    engine.disconnect({'topic':'error', 'cb':onError})
    workIdx += 1
    #
    languages__list_tuple_word_location_length_elapsedTime[language] = list_tuple_word_location_length_elapsedTime
    list_tuple_word_location_length_elapsedTime = []
    #




print('languages__list_tuple_word_location_length_elapsedTime', '************************')
import pprint
pp = pprint.PrettyPrinter(indent=4)
pp.pprint(languages__list_tuple_word_location_length_elapsedTime)
